# スマホ対応改善：検索・結果画面の分離

## 📱 変更の背景

スマホ画面で検索フォームと結果が縦並びになり、結果が見えにくい問題を解決するため、検索条件画面と結果画面を別ページに分離しました。

---

## 🔄 変更内容

### 1. ページ構成の変更

**変更前:**
```
/ (ホーム)
  └─ 検索フォーム + 天気 + スケジュール + 地図（全部1ページ）
/about
  └─ データ出典
```

**変更後:**
```
/ (検索ページ)
  └─ 検索フォーム + 天気 + 使い方ガイド
/result (結果ページ)
  └─ スケジュール + 地図（スマホで切り替え可能）
/about (データ出典)
  └─ データ出典・ライセンス情報
```

---

## 📁 ファイル変更

### 新規作成

#### 1. `client/src/pages/SearchPage.jsx`
**目的**: 検索条件入力専用ページ

**主な機能**:
- 検索フォーム（出発地、テーマ、時刻、滞在時間など）
- 天気ウィジェット表示
- スケジュール生成後、`/result` に遷移
- 使い方ガイド表示
- エラーハンドリング

**データの受け渡し**:
```javascript
navigate('/result', {
  state: {
    schedule: result.data,
    searchParams: params
  }
});
```

#### 2. `client/src/pages/ResultPage.jsx`
**目的**: スケジュール・地図表示専用ページ

**主な機能**:
- スケジュール詳細表示
- 地図表示（鉄道路線含む）
- **スマホ用**: スケジュール/地図の切り替えボタン
- **PC用**: 左右2カラムレイアウト（スケジュール | 地図）
- 「新しく検索」ボタンで検索ページに戻る

**スマホ対応の工夫**:
```jsx
{/* スマホ用：表示切り替えボタン */}
<div className="flex gap-2 md:hidden">
  <button onClick={() => setShowMap(false)}>スケジュール</button>
  <button onClick={() => setShowMap(true)}>地図</button>
</div>

{/* スケジュール表示（スマホで切り替え） */}
<div className={`${showMap ? 'hidden md:block' : 'block'}`}>
  <ScheduleView schedule={schedule} />
</div>

{/* 地図表示（スマホで切り替え） */}
<div className={`${!showMap ? 'hidden md:block' : 'block'}`}>
  <Map ... />
</div>
```

---

### 更新ファイル

#### 1. `client/src/App.jsx`
**変更内容**: ルート設定の変更

**変更前**:
```jsx
<Route path="/" element={<HomePage />} />
<Route path="/about" element={<AboutPage />} />
```

**変更後**:
```jsx
<Route path="/" element={<SearchPage />} />
<Route path="/result" element={<ResultPage />} />
<Route path="/about" element={<AboutPage />} />
```

---

### 削除ファイル

#### 1. `client/src/pages/HomePage.jsx`
**理由**: SearchPageとResultPageに機能を分離したため不要

---

## 📱 スマホでの動作

### 検索ページ (`/`)
1. 画面全体に検索フォームが表示される
2. 天気ウィジェットが見やすく表示される
3. 使い方ガイドが表示される
4. スケジュール生成ボタンをタップ
5. 結果ページに自動遷移

### 結果ページ (`/result`)
1. **デフォルト**: 地図が全画面表示
2. 上部に「スケジュール」「地図」切り替えボタン表示
3. 「スケジュール」タップでスケジュール詳細に切り替え
4. 「地図」タップで地図表示に切り替え
5. 「新しく検索」ボタンで検索ページに戻る
6. 下部に「条件を変更」「ページトップへ」ボタン

**切り替えアニメーション**:
- 瞬時に切り替わる（フェードなどは不要）
- スクロール位置は維持される

---

## 💻 PC（タブレット）での動作

### 検索ページ (`/`)
- 中央寄せレイアウト（最大幅: 672px）
- 検索フォームが見やすく配置
- 天気ウィジェットが適切なサイズで表示

### 結果ページ (`/result`)
- **2カラムレイアウト**
  - 左: スケジュール詳細（固定幅: 384px）
  - 右: 地図（残り全領域）
- 切り替えボタンは非表示（常に両方表示）
- スクロールは左パネルのみ

---

## 🎨 UI/UX の改善点

### 1. 明確な画面遷移
- 検索 → 結果という自然な流れ
- 各ページの目的が明確

### 2. スマホでの視認性向上
- 結果表示時にフォームが邪魔にならない
- 地図・スケジュールを全画面で確認可能
- 切り替えボタンで簡単に表示切替

### 3. 戻る操作の簡単化
- 「新しく検索」ボタンで即座に検索ページへ
- ブラウザの戻るボタンも機能

### 4. データ永続化
- React Router の `state` を使用
- ページリロード時は検索ページに戻る（意図的な設計）

---

## 🧪 テストポイント

### スマホ（375x667）での確認
- [ ] 検索ページが全画面表示される
- [ ] 検索フォームがスクロール可能
- [ ] 天気ウィジェットが見やすい
- [ ] スケジュール生成後、結果ページに遷移
- [ ] 結果ページで「スケジュール」「地図」が切り替わる
- [ ] 切り替えボタンがタップしやすい
- [ ] 「新しく検索」で検索ページに戻る

### タブレット（768x1024）での確認
- [ ] 検索ページが中央寄せで表示される
- [ ] 結果ページが2カラムレイアウト
- [ ] 切り替えボタンが非表示（md:hidden）
- [ ] スケジュールと地図が同時表示される

### PC（1920x1080）での確認
- [ ] 検索ページが適切な幅で表示される
- [ ] 結果ページの左右比率が適切
- [ ] 地図が広々と表示される
- [ ] すべての操作がスムーズ

---

## 🔧 技術的な実装詳細

### React Router v6 の `state` を使用したデータ受け渡し

**SearchPage.jsx での送信**:
```javascript
navigate('/result', {
  state: {
    schedule: result.data,      // スケジュールデータ
    searchParams: params         // 検索パラメータ
  }
});
```

**ResultPage.jsx での受信**:
```javascript
const location = useLocation();

useEffect(() => {
  if (location.state?.schedule) {
    setSchedule(location.state.schedule);
    setSearchParams(location.state.searchParams);
  } else {
    // データがない場合は検索ページに戻る
    navigate('/');
  }
}, [location, navigate]);
```

### Tailwind CSS のレスポンシブクラス活用

**スマホ/PCでの表示切り替え**:
- `md:hidden`: タブレット以上で非表示
- `md:block`: タブレット以上で表示
- `md:w-96`: タブレット以上で幅384px
- `flex-col md:flex-row`: スマホで縦並び、PC で横並び

---

## 📊 変更統計

- **新規ファイル**: 2個（SearchPage.jsx, ResultPage.jsx）
- **更新ファイル**: 1個（App.jsx）
- **削除ファイル**: 1個（HomePage.jsx）
- **変更行数**: 約200行（新規追加）

---

## 🚀 デプロイ時の注意事項

### 1. ルーティングの動作確認
- SPA（Single Page Application）のため、サーバー側のルーティング設定が必要
- すべてのパス（/, /result, /about）で index.html を返す設定

### 2. Vite の設定（開発環境）
- デフォルトで SPA ルーティング対応済み
- 問題なし

### 3. Render.com の設定（本番環境）
- `server/server.js` の SPA フォールバック設定が有効
- すでに実装済み（Line 40-52）

---

以上、スマホ対応のための画面分離実装が完了しました。
